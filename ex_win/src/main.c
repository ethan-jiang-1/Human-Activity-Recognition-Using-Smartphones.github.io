#include <stdio.h>

#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include "fft.h"
#include "kmem.h"
#include "freq_tbl.h"

#define NFFT 128

float t_signal[] = {0.87083336, 0.84583341, 0.85138888, 0.85694444, 0.80833337, 0.69722227,
					0.64722226, 0.62777782, 0.77222223, 0.82083335, 0.84305562, 0.83194449,
					0.90694445, 1.09861115, 1.11944452, 1.11666674, 1.04861114, 1.09166669,
					1.2444445, 1.41388892, 1.47083339, 1.42916673, 1.26388889, 1.00555558,
					0.79583335, 0.7430556, 0.81527779, 0.81527779, 1.02361118, 1.01527783,
					0.9847223, 0.88333339, 0.83750006, 0.88472228, 0.93472229, 0.92916672,
					0.92916672, 0.72083338, 0.65416667, 0.65416667, 0.68194446, 0.85694444,
					0.85694444, 0.88055561, 1.01527783, 1.01527783, 1.06666673, 1.05694449,
					1.03888889, 1.04861114, 1.13750002, 1.30555565, 1.4527778, 1.51527784,
					1.42500006, 1.25694453, 1.10833339, 1.10555561, 1.13333335, 1.12638889,
					1.0722223, 0.97777784, 0.94722222, 1.03611111, 1.11111117, 1.1069445,
					1.00555558, 0.84861119, 0.68055556, 0.54722224, 0.50416668, 0.57361113,
					0.62916671, 0.70972225, 0.72916668, 0.74861112, 0.89305563, 0.95694447,
					0.98055563, 0.96666671, 1.04861114, 1.14444448, 1.25138896, 1.20555563,
					1.37222226, 1.11388896, 0.85416666, 0.77916669, 0.89166674, 0.98749999,
					1.14722226, 1.13055556, 1.06805562, 0.95694447, 0.90416667, 0.91388891,
					0.94027786, 0.95694447, 0.9166667, 0.82500003, 0.82500003, 0.7513889,
					0.79305556, 0.79305556, 0.85416666, 0.79305556, 0.79305556, 0.82222224,
					0.93888897, 0.93888897, 1.04861114, 1.22916669, 1.22916669, 1.3319445,
					1.45000001, 1.3666667, 1.21944445, 1.12638889, 1.14861116, 1.19861117,
					1.18750003, 1.05138892, 0.95972225, 0.99305556, 0.99305556, 1.15138894,
					1.15138894, 1.0722223};

void exec_fft_real()
{
	printf("\n#### exec_fft_real\n");
	fft_config_t *real_fft_plan = fft_init(NFFT, FFT_REAL, FFT_FORWARD, NULL, NULL);
	//fft_config_t *real_fft_plan = fft_init(NFFT, FFT_COMPLEX, FFT_FORWARD, NULL, NULL);
	//memset(real_fft_plan->input, 0, NFFT * sizeof(float));
	for (int i = 0; i < NFFT; i++)
	{
		real_fft_plan->input[i] = t_signal[i];
	}

	printf("\n\n real_fft_plan\n");
	fft_execute(real_fft_plan);
	//for (int k = 0; k < real_fft_plan->size / 2; k++)
	for (int k = 0; k < real_fft_plan->size; k++)
	{
		float re = real_fft_plan->output[2 * k];
		float im = real_fft_plan->output[2 * k + 1];
		if (k % 2 == 0)
			printf("\n");
		printf("%e, %ej  ", re, im);
	}
	printf("\n");
	fft_destroy(real_fft_plan);
}

/* 
@"1.260333e+02, 5.222206e-01j  7.927176e-01, -4.724740e-01j  \r\n"
@"1.437086e+00, 3.396957e+00j  -1.291216e+00, -2.102428e+00j  \r\n"
@"-7.708042e+00, 1.217533e+01j  -1.095452e+00, -3.352157e-01j  \r\n"
@"-3.264781e-01, 2.387134e+00j  1.381101e+00, -6.768687e-01j  \r\n"
@"6.058383e+00, -2.358231e+00j  -7.821741e-01, 3.697418e-01j  \r\n"
@"3.025109e-01, -6.053813e-01j  -5.390959e-01, 3.592759e+00j  \r\n"
@"2.682204e+00, 1.594238e+00j  -1.487982e+00, -1.277464e+00j  \r\n"
@"2.093679e+00, -1.133876e+00j  -1.383285e+00, -5.094665e-01j  \r\n"
@"-2.662664e+00, -8.611962e-01j  1.984093e+00, 2.692416e+00j  \r\n"
@"9.237393e-01, 1.528407e+00j  -3.557728e-01, 1.224599e-01j  \r\n"
@"9.361607e-02, -2.142952e+00j  -1.426218e+00, 2.689872e+00j  \r\n"
@"-1.108361e+00, -1.755466e-01j  -1.637529e+00, 1.025870e-01j  \r\n"
@"-9.568988e-01, 9.183156e-01j  -7.160269e-01, 2.418655e-01j  \r\n"
@"1.893008e-01, 4.347163e-02j  9.055045e-02, -4.645686e-02j  \r\n"
@"2.171067e-01, 3.145002e-01j  2.793000e-01, -4.040656e-01j  \r\n"
@"3.692137e-01, 2.385787e-01j  -2.243932e-01, 3.465393e-02j  \r\n"
@"1.527786e-01, -2.277794e-01j  -4.676233e-01, 6.010830e-01j  \r\n"
@"-6.757724e-01, 1.330066e-01j  7.053605e-02, -2.691968e-01j  \r\n"
@"-1.463147e-01, -9.611990e-02j  -2.206250e-01, -3.803101e-01j  \r\n"
@"3.299709e-01, 1.133064e-01j  -2.910910e-01, 5.784239e-01j  \r\n"
@"-6.619975e-02, 7.436520e-02j  -2.016842e-03, -3.007431e-01j  \r\n"
@"-3.682234e-01, -9.097181e-03j  -1.966413e-01, -3.542943e-01j  \r\n"
@"2.381151e-01, -3.316285e-01j  -1.838373e-02, 2.317488e-01j  \r\n"
@"1.960315e-01, 4.563332e-02j  4.172934e-01, -7.983029e-02j  \r\n"
@"-5.845572e-01, 2.915825e-01j  1.028554e-01, 8.760893e-02j  \r\n"
@"5.181395e-01, -1.357202e-01j  -1.552884e-01, -3.198126e-01j  \r\n"
@"-1.485713e-01, 2.285379e-02j  1.127721e-01, 1.024573e-01j  \r\n"
@"-1.034151e-01, 7.108131e-02j  -1.218933e-01, 2.418569e-01j  \r\n"
@"-2.186151e-01, 1.867037e-01j  -5.525316e-01, 4.811653e-02j  \r\n"
@"3.887960e-02, 1.302918e-01j  1.603797e-01, 4.317955e-01j  \r\n"
@"-7.255936e-02, 1.533079e-02j  7.594347e-02, -8.050013e-02j  \r\n"
@"-5.496342e-01, 2.022896e-01j  -1.911927e-01, -2.209341e-01j  \r\n"
*/


void exec_fft_complex()
{
	printf("\n#### exec_fft_complex\n");
	fft_config_t *complex_fft_plan = fft_init(NFFT, FFT_COMPLEX, FFT_FORWARD, NULL, NULL);
	//memset(complex_fft_plan->input, 0, NFFT * sizeof(float));
	for (int i = 0; i < NFFT; i++)
	{
		complex_fft_plan->input[i*2] = t_signal[i];
		complex_fft_plan->input[i*2 + 1] = 0;
	}

	printf("\n\n complex_fft_plan\n");
	fft_execute(complex_fft_plan);
	//for (int k = 0; k < complex_fft_plan->size / 2; k++)
	for (int k = 0; k < complex_fft_plan->size; k++)
	{
		float re = complex_fft_plan->output[2 * k];
		float im = complex_fft_plan->output[2 * k + 1];
		if (k % 2 == 0)
			printf("\n");
		printf("%e, %ej  ", re, im);
	}
	printf("\n");
	fft_destroy(complex_fft_plan);
}

/*
@"1.260333e+02, 0.000000e+00j  7.927176e-01, -4.724740e-01j  \r\n"
@"1.437086e+00, 3.396957e+00j  -1.291216e+00, -2.102428e+00j  \r\n"
@"-7.708042e+00, 1.217533e+01j  -1.095452e+00, -3.352158e-01j  \r\n"
@"-3.264778e-01, 2.387134e+00j  1.381101e+00, -6.768690e-01j  \r\n"
@"6.058383e+00, -2.358232e+00j  -7.821741e-01, 3.697417e-01j  \r\n"
@"3.025109e-01, -6.053814e-01j  -5.390954e-01, 3.592759e+00j  \r\n"
@"2.682204e+00, 1.594238e+00j  -1.487982e+00, -1.277464e+00j  \r\n"
@"2.093679e+00, -1.133876e+00j  -1.383285e+00, -5.094664e-01j  \r\n"
@"-2.662664e+00, -8.611961e-01j  1.984093e+00, 2.692416e+00j  \r\n"
@"9.237395e-01, 1.528407e+00j  -3.557730e-01, 1.224600e-01j  \r\n"
@"9.361625e-02, -2.142952e+00j  -1.426218e+00, 2.689873e+00j  \r\n"
@"-1.108361e+00, -1.755463e-01j  -1.637529e+00, 1.025872e-01j  \r\n"
@"-9.568987e-01, 9.183155e-01j  -7.160267e-01, 2.418657e-01j  \r\n"
@"1.893009e-01, 4.347157e-02j  9.055017e-02, -4.645668e-02j  \r\n"
@"2.171071e-01, 3.144989e-01j  2.792999e-01, -4.040657e-01j  \r\n"
@"3.692142e-01, 2.385789e-01j  -2.243931e-01, 3.465390e-02j  \r\n"
@"1.527786e-01, -2.277794e-01j  -4.676233e-01, 6.010832e-01j  \r\n"
@"-6.757722e-01, 1.330071e-01j  7.053591e-02, -2.691967e-01j  \r\n"
@"-1.463156e-01, -9.611957e-02j  -2.206252e-01, -3.803101e-01j  \r\n"
@"3.299708e-01, 1.133066e-01j  -2.910909e-01, 5.784241e-01j  \r\n"
@"-6.619945e-02, 7.436538e-02j  -2.016842e-03, -3.007429e-01j  \r\n"
@"-3.682234e-01, -9.097092e-03j  -1.966414e-01, -3.542943e-01j  \r\n"
@"2.381148e-01, -3.316282e-01j  -1.838382e-02, 2.317488e-01j  \r\n"
@"1.960317e-01, 4.563367e-02j  4.172935e-01, -7.983005e-02j  \r\n"
@"-5.845572e-01, 2.915824e-01j  1.028554e-01, 8.760887e-02j  \r\n"
@"5.181391e-01, -1.357203e-01j  -1.552886e-01, -3.198127e-01j  \r\n"
@"-1.485708e-01, 2.285355e-02j  1.127719e-01, 1.024573e-01j  \r\n"
@"-1.034153e-01, 7.108122e-02j  -1.218933e-01, 2.418570e-01j  \r\n"
@"-2.186158e-01, 1.867046e-01j  -5.525318e-01, 4.811680e-02j  \r\n"
@"3.887944e-02, 1.302921e-01j  1.603798e-01, 4.317954e-01j  \r\n"
@"-7.255888e-02, 1.533175e-02j  7.594335e-02, -8.050048e-02j  \r\n"
@"-5.496343e-01, 2.022902e-01j  -1.911929e-01, -2.209339e-01j  \r\n"

@"5.222206e-01, 0.000000e+00j  -1.911927e-01, 2.209341e-01j  \r\n"
@"-5.496344e-01, -2.022897e-01j  7.594347e-02, 8.050036e-02j  \r\n"
@"-7.255983e-02, -1.533175e-02j  1.603796e-01, -4.317955e-01j  \r\n"
@"3.887944e-02, -1.302919e-01j  -5.525317e-01, -4.811659e-02j  \r\n"
@"-2.186155e-01, -1.867038e-01j  -1.218934e-01, -2.418569e-01j  \r\n"
@"-1.034153e-01, -7.108125e-02j  1.127722e-01, -1.024575e-01j  \r\n"
@"-1.485710e-01, -2.285343e-02j  -1.552883e-01, 3.198125e-01j  \r\n"
@"5.181391e-01, 1.357204e-01j  1.028554e-01, -8.760905e-02j  \r\n"
@"-5.845571e-01, -2.915825e-01j  4.172933e-01, 7.983017e-02j  \r\n"
@"1.960315e-01, -4.563361e-02j  -1.838380e-02, -2.317489e-01j  \r\n"
@"2.381150e-01, 3.316283e-01j  -1.966411e-01, 3.542947e-01j  \r\n"
@"-3.682235e-01, 9.097077e-03j  -2.016723e-03, 3.007430e-01j  \r\n"
@"-6.619978e-02, -7.436526e-02j  -2.910911e-01, -5.784241e-01j  \r\n"
@"3.299709e-01, -1.133065e-01j  -2.206250e-01, 3.803102e-01j  \r\n"
@"-1.463149e-01, 9.611938e-02j  7.053604e-02, 2.691966e-01j  \r\n"
@"-6.757725e-01, -1.330067e-01j  -4.676233e-01, -6.010831e-01j  \r\n"
@"1.527786e-01, 2.277794e-01j  -2.243931e-01, -3.465387e-02j  \r\n"
@"3.692136e-01, -2.385788e-01j  2.793000e-01, 4.040655e-01j  \r\n"
@"2.171066e-01, -3.144997e-01j  9.055042e-02, 4.645677e-02j  \r\n"
@"1.893008e-01, -4.347174e-02j  -7.160270e-01, -2.418654e-01j  \r\n"
@"-9.568990e-01, -9.183156e-01j  -1.637529e+00, -1.025870e-01j  \r\n"
@"-1.108361e+00, 1.755467e-01j  -1.426218e+00, -2.689873e+00j  \r\n"
@"9.361631e-02, 2.142952e+00j  -3.557729e-01, -1.224599e-01j  \r\n"
@"9.237393e-01, -1.528407e+00j  1.984093e+00, -2.692417e+00j  \r\n"
@"-2.662664e+00, 8.611962e-01j  -1.383285e+00, 5.094667e-01j  \r\n"
@"2.093679e+00, 1.133875e+00j  -1.487982e+00, 1.277464e+00j  \r\n"
@"2.682204e+00, -1.594238e+00j  -5.390961e-01, -3.592759e+00j  \r\n"
@"3.025110e-01, 6.053812e-01j  -7.821741e-01, -3.697418e-01j  \r\n"
@"6.058384e+00, 2.358231e+00j  1.381101e+00, 6.768687e-01j  \r\n"
@"-3.264781e-01, -2.387134e+00j  -1.095452e+00, 3.352158e-01j  \r\n"
@"-7.708044e+00, -1.217533e+01j  -1.291215e+00, 2.102429e+00j  \r\n"
@"1.437086e+00, -3.396957e+00j  7.927176e-01, 4.724737e-01j  \r\n"

*/

void exec_split_singal()
{
	printf("\n#### exec_split_singal\n");
}

int main(int argc, const char *argv[])
{
	printf("hello from main\n");

	exec_fft_real();
	exec_fft_complex();

	exec_split_singal();

	return 1;
}
