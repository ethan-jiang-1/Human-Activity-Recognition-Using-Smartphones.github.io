#include <stdio.h>

#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include "fft.h"
#include "kmem.h"

#define NFFT 128

float t_signal[] = {0.87083336, 0.84583341, 0.85138888, 0.85694444, 0.80833337, 0.69722227,
					0.64722226, 0.62777782, 0.77222223, 0.82083335, 0.84305562, 0.83194449,
					0.90694445, 1.09861115, 1.11944452, 1.11666674, 1.04861114, 1.09166669,
					1.2444445, 1.41388892, 1.47083339, 1.42916673, 1.26388889, 1.00555558,
					0.79583335, 0.7430556, 0.81527779, 0.81527779, 1.02361118, 1.01527783,
					0.9847223, 0.88333339, 0.83750006, 0.88472228, 0.93472229, 0.92916672,
					0.92916672, 0.72083338, 0.65416667, 0.65416667, 0.68194446, 0.85694444,
					0.85694444, 0.88055561, 1.01527783, 1.01527783, 1.06666673, 1.05694449,
					1.03888889, 1.04861114, 1.13750002, 1.30555565, 1.4527778, 1.51527784,
					1.42500006, 1.25694453, 1.10833339, 1.10555561, 1.13333335, 1.12638889,
					1.0722223, 0.97777784, 0.94722222, 1.03611111, 1.11111117, 1.1069445,
					1.00555558, 0.84861119, 0.68055556, 0.54722224, 0.50416668, 0.57361113,
					0.62916671, 0.70972225, 0.72916668, 0.74861112, 0.89305563, 0.95694447,
					0.98055563, 0.96666671, 1.04861114, 1.14444448, 1.25138896, 1.20555563,
					1.37222226, 1.11388896, 0.85416666, 0.77916669, 0.89166674, 0.98749999,
					1.14722226, 1.13055556, 1.06805562, 0.95694447, 0.90416667, 0.91388891,
					0.94027786, 0.95694447, 0.9166667, 0.82500003, 0.82500003, 0.7513889,
					0.79305556, 0.79305556, 0.85416666, 0.79305556, 0.79305556, 0.82222224,
					0.93888897, 0.93888897, 1.04861114, 1.22916669, 1.22916669, 1.3319445,
					1.45000001, 1.3666667, 1.21944445, 1.12638889, 1.14861116, 1.19861117,
					1.18750003, 1.05138892, 0.95972225, 0.99305556, 0.99305556, 1.15138894,
					1.15138894, 1.0722223};

void exec_fft()
{
	fft_config_t *real_fft_plan = fft_init(NFFT, FFT_REAL, FFT_FORWARD, NULL, NULL);
	//memset(real_fft_plan->input, 0, NFFT * sizeof(float));
	for (int i = 0; i < NFFT; i++)
	{
		real_fft_plan->input[i] = t_signal[i];
	}

	fft_execute(real_fft_plan);
	for (int k = 0; k < real_fft_plan->size / 2; k++)
	{
		float re = real_fft_plan->output[2 * k];
		float im = real_fft_plan->output[2 * k + 1];
		if (k % 2 == 0) 
			printf("\n");
		printf("%e, %ej  ", re, im);
		// LOGD("re: %f, im: %f", re, im);
		//float mag = sqrt(re * re + im * im);
		// LOGD("k: %d, mag: %f, sum: %f\n", k, mag, sum);
		//sum += mag;
	}
	printf("\n");
	fft_destroy(real_fft_plan);

	// printf("\n sum: %lf \n", sum);
	//return sum;
}

int main(int argc, const char *argv[])
{
	printf("hello from main\n");

	exec_fft();
	// /* Features: */
	// float features[argc - 1];
	// int i;
	// for (i = 1; i < argc; i++)
	// {
	//     features[i - 1] = atof(argv[i]);
	// }

	// /* Prediction: */
	// printf("%d", predict(features));
	return 1;
}

int xxmain()
{
	printf("Hello World!\n");

	return (0);
}

/* 
@"1.260333e+02, 5.222206e-01j  7.927176e-01, -4.724740e-01j  \r\n"
@"1.437086e+00, 3.396957e+00j  -1.291216e+00, -2.102428e+00j  \r\n"
@"-7.708042e+00, 1.217533e+01j  -1.095452e+00, -3.352157e-01j  \r\n"
@"-3.264781e-01, 2.387134e+00j  1.381101e+00, -6.768687e-01j  \r\n"
@"6.058383e+00, -2.358231e+00j  -7.821741e-01, 3.697418e-01j  \r\n"
@"3.025109e-01, -6.053813e-01j  -5.390959e-01, 3.592759e+00j  \r\n"
@"2.682204e+00, 1.594238e+00j  -1.487982e+00, -1.277464e+00j  \r\n"
@"2.093679e+00, -1.133876e+00j  -1.383285e+00, -5.094665e-01j  \r\n"
@"-2.662664e+00, -8.611962e-01j  1.984093e+00, 2.692416e+00j  \r\n"
@"9.237393e-01, 1.528407e+00j  -3.557728e-01, 1.224599e-01j  \r\n"
@"9.361607e-02, -2.142952e+00j  -1.426218e+00, 2.689872e+00j  \r\n"
@"-1.108361e+00, -1.755466e-01j  -1.637529e+00, 1.025870e-01j  \r\n"
@"-9.568988e-01, 9.183156e-01j  -7.160269e-01, 2.418655e-01j  \r\n"
@"1.893008e-01, 4.347163e-02j  9.055045e-02, -4.645686e-02j  \r\n"
@"2.171067e-01, 3.145002e-01j  2.793000e-01, -4.040656e-01j  \r\n"
@"3.692137e-01, 2.385787e-01j  -2.243932e-01, 3.465393e-02j  \r\n"
@"1.527786e-01, -2.277794e-01j  -4.676233e-01, 6.010830e-01j  \r\n"
@"-6.757724e-01, 1.330066e-01j  7.053605e-02, -2.691968e-01j  \r\n"
@"-1.463147e-01, -9.611990e-02j  -2.206250e-01, -3.803101e-01j  \r\n"
@"3.299709e-01, 1.133064e-01j  -2.910910e-01, 5.784239e-01j  \r\n"
@"-6.619975e-02, 7.436520e-02j  -2.016842e-03, -3.007431e-01j  \r\n"
@"-3.682234e-01, -9.097181e-03j  -1.966413e-01, -3.542943e-01j  \r\n"
@"2.381151e-01, -3.316285e-01j  -1.838373e-02, 2.317488e-01j  \r\n"
@"1.960315e-01, 4.563332e-02j  4.172934e-01, -7.983029e-02j  \r\n"
@"-5.845572e-01, 2.915825e-01j  1.028554e-01, 8.760893e-02j  \r\n"
@"5.181395e-01, -1.357202e-01j  -1.552884e-01, -3.198126e-01j  \r\n"
@"-1.485713e-01, 2.285379e-02j  1.127721e-01, 1.024573e-01j  \r\n"
@"-1.034151e-01, 7.108131e-02j  -1.218933e-01, 2.418569e-01j  \r\n"
@"-2.186151e-01, 1.867037e-01j  -5.525316e-01, 4.811653e-02j  \r\n"
@"3.887960e-02, 1.302918e-01j  1.603797e-01, 4.317955e-01j  \r\n"
@"-7.255936e-02, 1.533079e-02j  7.594347e-02, -8.050013e-02j  \r\n"
@"-5.496342e-01, 2.022896e-01j  -1.911927e-01, -2.209341e-01j  \r\n"
*/